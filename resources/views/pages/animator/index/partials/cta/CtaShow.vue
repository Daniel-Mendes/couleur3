<script setup>
import BaseCard from "@/Components/Animator/Bases/BaseCard.vue";
import BaseButton from "@/Components/Animator/Bases/BaseButton.vue";
import BaseCountdown from "@/Components/Animator/Bases/BaseCountdown.vue";
import Color from "@/Enums/Color.js";
import EndingMessage from "../Answers/EndingMessage.vue";
import { useInteractionStore } from "@/Stores/useInteractionStore.js";
import { storeToRefs } from "pinia";

const interactionStore = useInteractionStore();
const { currentInteraction } = storeToRefs(interactionStore);

const duration =
    new Date(currentInteraction.value.ended_at).getTime() -
    new Date().getTime();
const sec = Math.floor((duration / 1000) % 60);
const min = Math.floor(duration / (1000 * 60));
</script>

<template>
    <BaseCard :color="Color.SECONDARY">
        <template #title>
            <div class="flex flex-auto flex-row items-center justify-between">
                <EndingMessage />

                <BaseCountdown
                    :color="Color.SECONDARY"
                    :sec="sec"
                    :min="min"
                />
            </div>
        </template>
        <template #subtitle
            >Le lien suivant a bien été envoyé aux auditeurs :</template
        >
        <template #content>
            <span class="font-light italic"
                >{{ currentInteraction.title }} -
                {{ currentInteraction.call_to_action.link }}</span
            >
        </template>

        <template #actions>
            <div class="flex flex-row gap-3">
                <BaseButton @click="interactionStore.endInteraction()"
                    >Fin de l'interaction</BaseButton
                >
            </div>
        </template>
    </BaseCard>
</template>
